#!/bin/bash

PORT=4000

findProccess() {
	POUT=$(ps fax | grep 'godoc' | grep -v grep | awk -F ' ' '{print $1}')
}

stopProccess() {
	findProccess
	if [[ "" -eq "$POUT" ]]; then
		echo "No proccess found"
	else
		echo "Found proccess runnint at PID: $POUT"
		echo "Kill proccess $POUT"
		kill -9 $POUT
	fi
}

startNew() {
	stopProccess
	echo "Running new proccess"
	exec /home/action/.local/lib/google-cloud-sdk/platform/google_appengine/godoc -http=:$PORT &
}

usage() {
	cat <<EOF
Usage: $0 [-h|-f|-k|-s]

where
	-h This help
	-f Find goappdoc running
	-k Kill current proccess
	-s Start new godocapp
EOF
}

case $1 in
	-h|--help)
		usage
		;;
	-f|--find)
		findProccess
		echo "Found proccess running at PID: $POUT"
		;;
	-k|--kill)
		stopProccess
		;;
	-s|--start)
		startNew
		;;
esac
